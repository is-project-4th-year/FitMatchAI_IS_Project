# FitMatch AI â€” Goal-Driven Workout Planner & Weekly Adaptation (Android + Firebase + Cloud Run)

FitMatch AI is a mobile app that creates **personalized, multi-week workout plans** from your metrics (age, height, weight, BMI, workouts/week, calories, equipment) and then **adapts weekly** based on your **training adherence**. Plans are generated by a FastAPI ML service on **Google Cloud Run** and stored in **Firebase**. Users log daily workouts, **finalize** each training week, and receive a **continuation plan** with progressive adjustments (volume/intensity/progression bias).

**Stack:** Android (Kotlin/Jetpack Compose) â€¢ Firebase (Auth + Firestore) â€¢ FastAPI (Docker/Cloud Run) â€¢ Retrofit/OkHttp  

---

## âœ¨ Major Features

- **Secure Authentication**
  - Firebase Auth (Email/Password & Phone). (Remember to add **package** + **SHA-1/SHA-256** in Firebase.)

- **Goal Management**
  - Create goals with **dropdown goal type**: _Fat loss_, _Hypertrophy_, _Endurance_.
  - Input **duration (weeks)** and **start date**; **end date auto-computed**.
  - Distinct **Active** vs **Past** goals; per-goal progress like `32 / 80 kg`.
  - After saving a goal: **snackbar** prompt â€œOpen Planâ€ â†’ navigates to Plan screen.

- **Plan Generation (ML)**
  - **Custom Workout** form to submit metrics; generates **week 0** (day offset 0).
  - **Day offset continuation**: if week 1 follows a 3-day microcycle, days continue **4-6** (not 1-3).
  - **Anti-repeat logic**: retries with a different `variant_seed` if new week is too similar to the last.

- **Workout Logging & Weekly Finalization**
  - Open **Day N** to log exercises; summaries stored per day.
  - Tap **Finalize This Week** to compute adherence:
    - `completion_pct` (â‰¥ 0.40 gate), `volume_scale`, `intensity_scale`, `progression_bias` (âˆ’1/0/1).
  - If passed, app **auto-regenerates** the next week using adherence-aware features.

- **Progress & Insights**
  - **Goal progress bar** (current vs target).
  - **Progress screen** with weekly summaries and charts (completion %, missed days, trends).

- **UX Improvements (Supervisor Feedback)**
  - Goal type is a **dropdown** (no free-text).
  - Equipment simplified to **Home workout** or **Gym workout**.
  - **Snackbars** for success (â€œWorkout plan createdâ€, â€œNew plan generatedâ€).
  - Clear calls-to-action: after goal creation, suggest **Create your plan**.

- **Robust Sync**
  - **Snapshot flip-back guard**: short â€œhold windowâ€ + â€œsticky latestâ€ to prevent UI reverting to stale Firestore snapshots.

---

## ğŸ§± Architecture (High-Level)

```

app/src/main/java/com/example/fitmatch/
â”œâ”€ screens/
â”‚  â”œâ”€ GoalScreen.kt         # Create/manage goals + snackbar (â€œOpen Planâ€)
â”‚  â”œâ”€ PlanScreen.kt         # Tabs: Current Plan / Custom Workout
â”‚  â””â”€ ProgressScreen.kt     # Charts + weekly summaries
â”œâ”€ Viewmodels/
â”‚  â”œâ”€ GoalsViewModel.kt     # goalsFlow, CRUD, progress updates
â”‚  â””â”€ PlanViewModel.kt      # observePlans, generate, finalize+regen, guards
â”œâ”€ models/
â”‚  â”œâ”€ GoalsRepository.kt    # Firestore (users/{uid}/goals)
â”‚  â””â”€ PlanRepositoryImpl.kt # Retrofit (predict), Firestore (workoutplan, features)
â”œâ”€ data/
â”‚  â”œâ”€ Goal.kt               # progress computed field
â”‚  â”œâ”€ PlanDTO.kt, ExerciseDTO.kt
â”‚  â””â”€ AdherenceSummary.kt
â””â”€ net/
â””â”€ FitmatchApi.kt        # /predict (FastAPI on Cloud Run)

```

---

## ğŸ”Œ Firestore Collections (by user)

```

users/{uid}/
â”œâ”€ goals/                         # Goal documents
â”‚  â””â”€ {goalId} {
â”‚       goalType: "hypertrophy" | "fatloss" | "endurance",
â”‚       durationWeeks: Int,
â”‚       workoutsPerWeek: Int,
â”‚       startDate: Long (ms),
â”‚       endDate:   Long (ms),
â”‚       targetValue: Float,
â”‚       currentValue: Float,
â”‚       status: "active" | "completed"
â”‚     }
â”œâ”€ features/                      # Latest base features snapshot
â”‚  â””â”€ auto doc {
â”‚       age, height, weight, bmi, goal_type, workouts_per_week, calories_avg, equipment,
â”‚       submitted_at: serverTimestamp()
â”‚     }
â”œâ”€ workoutplan/                   # Saved plans
â”‚  â””â”€ auto doc {
â”‚       plan_id, microcycle_days, exercises[], notes, model_version,
â”‚       created_at: serverTimestamp(),
â”‚       created_at_ms: Long (client now),
â”‚       week_index: Int,
â”‚       day_offset: Int
â”‚     }
â”œâ”€ plan_logs/{planId}/days/       # Per-day logs for adherence
â”‚  â””â”€ {dayDoc} {
â”‚       date: Long (ms),
â”‚       exercises_count: Int,
â”‚       exercises_completed: Int,
â”‚       volume_ratio: Double,
â”‚       intensity_ratio: Double
â”‚     }
â””â”€ adherence_summaries/
â””â”€ {planId}_{YYYY-Www} {
completion_pct, volume_scale, intensity_scale, missed_days, notes
}

````

---

## ğŸ§  Backend (FastAPI on Cloud Run)

- **Endpoint:** `POST /predict`  
  **Body:**  
  ```json
  {
    "user_id": "uid",
    "features": {
      "age": 23, "height": 180.0, "weight": 60.0, "bmi": 18.5,
      "goal_type": 1, "workouts_per_week": 3, "calories_avg": 1485.0,
      "equipment": "gym",
      "volume_scale": 1.0, "intensity_scale": 1.0, "progression_bias": 0
    },
    "week_index": 0,
    "variant_seed": 0
  }


**Response (excerpt):**

```json
{
  "prediction": 1.0,
  "plan_id": "hypertrophy_3d_dynamic_v1",
  "microcycle_days": 3,
  "exercises": [{ "day":1, "block":"Squat", "name":"Goblet Squat", ... }],
  "notes": "Auto-generated (seed 0, offset 0).",
  "model_version": "vX"
}
```



## ğŸ›  Installation (Android)

### Prerequisites

* [Android Studio](https://developer.android.com/studio) (SDK 34+)
* JDK 17
* Firebase project with **Auth** + **Firestore**
* Cloud Run service URL for the ML API (or local FastAPI)

### 1) Clone

```bash
git clone https://github.com/<your-org>/fitmatch-ai-android.git
```

### 2) Firebase Setup

* Add Android app in Firebase, set **package name**, add **SHA-1 & SHA-256**.
* Download `google-services.json` â†’ place in `app/google-services.json`.
* Enable Email/Phone sign-in in **Authentication**.

### 3) API Base URL

Add to `local.properties` (recommended):

```properties
FITMATCH_API_BASE=https://<your-cloud-run-host>
```

*or* set a `buildConfigField` in `app/build.gradle`:

```gradle
buildConfigField "String", "API_BASE", "\"https://<your-cloud-run-host>\""
```

### 4) Build & Run

Open in Android Studio â†’ Sync Gradle â†’ Run on device/emulator.

---

## â–¶ How to Use

1. **Create Your Goal**

   * Pick **goal type** (dropdown), enter **duration (weeks)** & **start date** (end date is auto-filled).
   * Save â†’ snackbar suggests **Open Plan**.

2. **Generate Plan**

   * Go to **Plan â†’ Custom Workout**, check/prefill your metrics, tap **Save Workout Plan**.
   * Snackbar: â€œ**Workout plan created**â€; tab snaps to **Current Plan**.

3. **Train & Log**

   * Tap **Day N** to open and log exercises. (Data stored under `plan_logs`.)

4. **Finalize Week**

   * Tap **Finalize This Week** â†’ computes adherence â†’ if pass, **new week** is generated:

     * Day numbering continues (e.g., 1-3 â†’ 4-6).
     * Plan may adjust using `volume_scale`, `intensity_scale`, `progression_bias`.

5. **Track Progress**

   * See goal bar (e.g., `32/80 kg`) and charts on the **Progress** screen.

---

## ğŸ§ª Developer Commands

* **Assemble Debug**

  ```bash
  ./gradlew assembleDebug
  ```
* **Run Unit Tests**

  ```bash
  ./gradlew test
  ```
* **Clean Build**

  ```bash
  ./gradlew clean
  ```

---

## ğŸ§© Troubleshooting

* **Phone Auth error (17028 / Invalid app info)**
  Add **package**, **SHA-1**, **SHA-256** in Firebase â†’ Project settings â†’ Apps.
  Re-download `google-services.json`.

* **Plan â€œrevertsâ€ to old one after creation**
  Ensure **`created_at_ms`** is written with client time and listener orders by `created_at_ms DESC`.
  Snapshot guard (hold window + sticky latest) is enabled in `PlanViewModel`.

* **Days reset to 1 each week**
  The repository writes **`day_offset`** and shifts exercise `day` â†’ UI groups by **absolute day**.

---

## ğŸ—ºï¸ Roadmap / Future Work

* **Wearables integration** to refine calories/recovery (HR, steps, sleep).
* **RPE & soreness-aware** micro-adjustments + deload detection.
* **Progressive overload per pattern** (hinge/squat/push/pull) with constraint solver.
* **Offline-first logging** with background sync & conflict resolution.
* **Exercise substitutions** by equipment/preferences with rationale.
* **Nutrition companion** (macro targets, adherence, reminders).
* **A/B multi-template** microcycle selection with policy learning.

---

## ğŸ¤ Contributing

1. Fork the repository
2. Create a feature branch: `git checkout -b feat/improve-adherence-chart`
3. Commit your changes
4. Push the branch & open a Pull Request

---

## ğŸ“œ License

Released under the [MIT License](https://opensource.org/licenses/MIT).

```
```
[![Review Assignment Due Date](https://classroom.github.com/assets/deadline-readme-button-22041afd0340ce965d47ae6ef1cefeee28c7c493a6346c4f15d667ab976d596c.svg)](https://classroom.github.com/a/l6edej4a)
[![Open in Visual Studio Code](https://classroom.github.com/assets/open-in-vscode-2e0aaae1b6195c2367325f4f02e2d04e9abb55f0b24a779b69b11b9e10269abc.svg)](https://classroom.github.com/online_ide?assignment_repo_id=19902939&assignment_repo_type=AssignmentRepo)
